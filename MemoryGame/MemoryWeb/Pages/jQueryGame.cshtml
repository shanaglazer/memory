@page
@model MemoryWeb.Pages.jQueryGameModel
@{
}

@*AF All styles can be within one set of style tags, no need to enclose each style in its own set of style tags *@
<style>
    .card {
        min-width: 80px;
        min-height: 80px;
        width: 100%;
        height: 100%;
        padding: 10px;
        color: darkorchid;
        background-color: darkorchid;
        border: 1px solid black;
        text-align: center;
        vertical-align: middle;
        font-size: xx-large;
        display: block;
        flex-direction: initial;
    }
</style>

<style>
    .size {
        max-width: 180px;
        width: 100%;
        height: 95px
    }
</style>

<div class="row table-responsive-*">
    <table>
        <tr>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
        </tr>
        <tr>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
        </tr>
        <tr>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
        </tr>
        <tr>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
        </tr>
        <tr>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
            <td><button id="card" class="card"></button></td>
        </tr>
    </table>
</div>
<div class="row">
    <div class="col-4" style="width:25%"><p class="size" id="msg" style="border:1px  solid black;" align="center">Click Start Game</p></div>
    <div class="col-4" style="width:25%">
        <table class="size" style="border:1px solid black;">
            <tr>
                <td style="padding:3px">Player A Score:</td>
                <td>Player B Score:</td>
            </tr>
            <tr>
                <td align="center" id="aScore" style="padding:3px">0</td>
                <td id="bScore" align="center">0</td>
            </tr>
        </table>
    </div>
    <div class="col-2" style="width:25%"><button class="size" id="btnStart">Start Game</button></div>
    <div class="col-2" style="width:25%"><button class="size" id="btnSwitch" disabled>Switch Turn</button></div>
</div>
<div class="row"><h1 style="text-align: center">jQuery Memory Game</h1></div>



@section Scripts{
    <script>
        let currentTurn = "A";
        let aScoreVal = 0;
        let bScoreVal = 0;
        let pair = false;
        let lstLetters = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"];
        let lstbuttons = [];
        let btnStart;
        let btnSwitch;
        let aScore;
        let bScore;


        $(document).ready(function () {
            btnStart = $("#btnStart");
            btnSwitch = $("#btnSwitch");
            aScore = $("#aScore");
            bScore = $("#bScore");
            btnStart.click(startGame);
            btnSwitch.click(switchTurn);
            lstbuttons = [...document.querySelectorAll("#card")];
            $(lstbuttons).prop('disabled', true);
            $(lstbuttons).click(cardClick);
            setupGame();
        });

        function enableButtons() {
            $(lstbuttons).prop('disabled', false);
        }

        function giveCardLetter() {
            let lstb = lstbuttons.slice();
            let lstl = lstLetters.slice();
            for (let i = 0; i < 15; i++) {
                let c = Math.floor(Math.random() * (lstl.length));
                let a = Math.floor(Math.random() * (lstb.length));
                //AF Instead of innerHTML, for this HW, you should use jquery to accomplish the same thing, and same thing when you use innerHTML a few lines down
                lstb[a].innerHTML = lstl[c].toString();
                lstb.splice(a, 1);
                let b = Math.floor(Math.random() * (lstb.length));
                lstb[b].innerHTML = lstl[c].toString().toUpperCase();
                lstb.splice(b, 1);
                lstl.splice(c, 1);
            }
        }

        function setCurrentTurn() {
            currentTurn = currentTurn == "A" ? "B" : "A";
        }

        function detectWinner() {
            let winner = "";
            if (aScoreVal > bScoreVal) {
                winner = "A";
                aScore.css('background-color', 'red');
            }
            else if (bScoreVal > aScoreVal) {
                bScore.css('background-color', 'red');
                winner = "B";
            }
            return winner;
        }

        /*AF You are using 2 rgb colors a lot and it can be prone to errors, likely it might be written wrong in one of the many places.  It would be more secure
        to put the rgb colors into variables and reference them like that*/
        function winnerMode() {
            btnSwitch.prop('disabled', true);
            $(lstbuttons).css('background-color', 'rgb(153, 50, 204)');
        }

        function messageText() {
            /*AF Instead of setting the message text to a certain message, and then changing that text if the game is over, the proper way to do this if for both
            options of messages to be part of the if statement.  Meaning you can keep your if statement checking if the game is over, and have an else statement to set the 
            message text to the other option if the game is not yet over*/
            let message = "Current turn: Player " + currentTurn;
            let finalmsg = pair == false ? message : "You got it! " + message;
            $("#msg").text(finalmsg);
            if (lstbuttons.filter(b => b.disabled == false).length == 0) {
                finalmsg = "Winner is " + detectWinner() + ". Click Start Game";
                $("#msg").text(finalmsg); 
                winnerMode();
            }
        }

        function doSwitchTurn() {
            pair = false;
            let lstcheckb = lstbuttons.filter(b => b.style.backgroundColor == 'rgb(255, 255, 255)');
            let a = ""; a = lstcheckb[0].innerHTML.toLowerCase();
            let b = ""; b = lstcheckb[1].innerHTML.toLowerCase();
            if (a == b) {
                pair = true;
                switch (currentTurn) {
                    case "A":
                        aScoreVal = aScoreVal + 1;
                        break;
                    case "B":
                        bScoreVal = bScoreVal + 1;
                        break;
                }
                setScore();
                $(lstcheckb).prop("disabled", true);
                $(lstcheckb).css('color', 'rgb(0, 0, 0)');
            }
            $(lstbuttons).css('background-color', 'rgb(153, 50, 204)');
            btnSwitch.prop('disabled', true);
        }

        function setScore() {
            aScore.text(aScoreVal);
            bScore.text(bScoreVal);
        }

        function buttonsClicked() {
            const array = lstbuttons.filter(btn => btn.style.backgroundColor == 'rgb(255, 255, 255)');
            let i = array.length;
            return i;
        }

        function setupGame() {
            pair = false;
            aScoreVal = 0;
            bScoreVal = 0;
            setScore();
            currentTurn = "A";
            $(lstbuttons).css({ 'background-color': 'rgb(153, 50, 204)', 'color': 'rgb(153, 50, 204)' });
            giveCardLetter();
            let lstlbl = $('[id*="Score"]');
            lstlbl.text("0");
            lstlbl.css('background-color', 'white');
        }

        function startGame() {
            enableButtons();
            setupGame();
            messageText();
        }

        function switchTurn() {
            doSwitchTurn();
            setCurrentTurn();
            messageText();
        }

        function cardClick(event) {
            const btn = event.target;
            if (buttonsClicked() < 2) {
                btn.style.backgroundColor = 'rgb(255, 255, 255)';
            }
            if (buttonsClicked() == 2) {
                $("#btnSwitch").prop('disabled', false);
            }
        }
    </script>
        }